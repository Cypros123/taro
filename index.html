<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Выберите 3 карты</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  :root{
    --bg:#0f0c11; --ink:#f3efe6; --muted:#b9a795; --gold:#d9b36c;
    --cardW:120px; --ratio:1.6;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--ink);
    background: radial-gradient(140% 120% at 50% -10%, rgba(233,200,145,.08), transparent 60%), #140e13;
    display:flex; flex-direction:column;
  }
  header{position:sticky; top:0; z-index:5; padding:12px 16px; background:linear-gradient(180deg, rgba(0,0,0,.5), transparent);
    border-bottom:1px solid rgba(255,255,255,.08); backdrop-filter: blur(4px);}
  .title{font-weight:700; font-size:16px;}
  .subtitle{font-size:12px; color:var(--muted)}
  .wrap{padding:14px; display:flex; flex-direction:column; gap:16px; align-items:center}
  .row{ display:flex; gap:14px; justify-content:center; flex-wrap:nowrap; }
  .card{
    width:var(--cardW); height:calc(var(--cardW)*var(--ratio));
    border:none; background:none; padding:0; cursor:pointer; perspective:1000px;
  }
  .card-inner{
    position:relative; width:100%; height:100%; border-radius:14px; overflow:hidden;
    transform-style:preserve-3d; transition: transform 0.8s ease;
    box-shadow:0 10px 22px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.06);
  }
  .card.selected .card-inner{ transform: rotateY(180deg); }
  .face,.back{
    position:absolute; inset:0; backface-visibility:hidden; -webkit-backface-visibility:hidden;
    display:flex; align-items:center; justify-content:center; border-radius:14px;
  }
  .back{
    background: linear-gradient(145deg, #261316, #140b0d);
    border:1px solid #6d3b3f;
  }
  .sigil{ width:62%; height:62%; border-radius:50%; border:2px dashed rgba(217,179,108,.55);
    display:grid; place-items:center; position:relative; }
  .sigil::after{ content:""; position:absolute; inset:12%; border-radius:50%; border:1px solid rgba(217,179,108,.35); }
  .sigil svg{ width:70%; opacity:.9; }
  .face{
    transform: rotateY(180deg);
    background-size:cover; background-position:center;
    background-color:#000;
  }
  .face img{ width:100%; height:100%; object-fit:cover; display:block; }
  .contbar{ position:fixed; left:50%; transform:translateX(-50%); bottom:16px; display:none; z-index:10; }
  .contbar.show{ display:block; }
  .contbtn{
    padding:12px 18px; border-radius:14px; border:1px solid rgba(255,255,255,.14);
    font-weight:700; background:linear-gradient(180deg, rgba(233,200,145,.22), rgba(233,200,145,.10));
    color:var(--ink); cursor:pointer; box-shadow:0 6px 18px rgba(0,0,0,.35);
  }
</style>
</head>
<body>
  <header>
    <div class="title">Выберите 3 карты</div>
    <div class="subtitle">Нажмите на карты — они перевернутся</div>
  </header>

  <div class="wrap">
    <div class="row" id="rowTop"></div>
    <div class="row" id="rowBottom"></div>
  </div>

  <div class="contbar" id="contbar">
    <button class="contbtn" id="btnContinue">Продолжить</button>
  </div>

<script>
const tg = window.Telegram?.WebApp; if (tg){ tg.ready(); tg.expand(); }

const LIMIT = 3;
const idsTop = [3,14,27];
const idsBottom = [45,9,62,71];
let selected = [];

const rowTop = document.getElementById('rowTop');
const rowBottom = document.getElementById('rowBottom');
const contbar = document.getElementById('contbar');
const btn = document.getElementById('btnContinue');

function faceUrl(id){
  // Если сайт хостится на https://USERNAME.github.io/taro/
  return `faces/${id}.png`;
  // При проблемах с путём можно сделать абсолютный: return `/taro/faces/${id}.png`;
}

function makeCard(id){
  const card = document.createElement('button');
  card.className = 'card'; card.type = 'button'; card.dataset.id = String(id);

  const inner = document.createElement('div'); inner.className = 'card-inner';

  const back = document.createElement('div'); back.className = 'back';
  back.innerHTML = \`
    <div class='sigil'>
      <svg viewBox='0 0 100 100' fill='none' xmlns='http://www.w3.org/2000/svg'>
        <circle cx='50' cy='50' r='30' stroke='#d9b36c' stroke-width='3' />
        <path d='M50 22 L54 46 L78 50 L54 54 L50 78 L46 54 L22 50 L46 46 Z' stroke='#e9c891' stroke-width='2'/>
      </svg>
    </div>\`;

  const face = document.createElement('div'); face.className = 'face';
  // Подстраховка: и фоном, и <img>
  face.style.backgroundImage = \`url(\${faceUrl(id)})\`;
  const img = document.createElement('img'); img.src = faceUrl(id); img.alt = 'card';
  face.appendChild(img);

  inner.appendChild(back); inner.appendChild(face);
  card.appendChild(inner);
  card.addEventListener('click', () => select(card, id));
  return card;
}

function build(){
  idsTop.forEach(id => rowTop.appendChild(makeCard(id)));
  idsBottom.forEach(id => rowBottom.appendChild(makeCard(id)));
}

function select(card, id){
  if (selected.length >= LIMIT) return;
  if (card.classList.contains('selected')) return;

  // на всякий случай ещё раз выставим изображение
  const face = card.querySelector('.face');
  if (face){
    face.style.backgroundImage = \`url(\${faceUrl(id)})\`;
    const img = face.querySelector('img'); if (img) img.src = faceUrl(id);
  }

  card.classList.add('selected');
  selected.push(id);

  if (selected.length === LIMIT){
    contbar.classList.add('show');
  }
}

btn.addEventListener('click', () => {
  const payload = { type: 'tarot_selection', cards: selected.slice(0,3) };
  if (tg){ tg.sendData(JSON.stringify(payload)); tg.close(); }
  else { alert(JSON.stringify(payload)); }
});

build();
</script>
</body>
</html>
